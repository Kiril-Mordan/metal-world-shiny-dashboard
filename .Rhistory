library(rvest)
library(stringr)
library(parallel)
library(splitstackshape)
library(tidyverse)
library(tidyr)
library(xml2)
library(parallel)
msbands <- "https://metalstorm.net/bands/"
pages <- read_html(msbands) %>% html_nodes("div.container") %>% html_nodes("div.pull-right") %>% html_nodes("ul.pagination") %>% html_nodes("li") %>% html_nodes("a") %>% html_text() %>% tail(.,1) %>% as.numeric(.)
pages_href <- sapply(1:pages, function(i){
paste0("https://metalstorm.net/bands/index.php?b_sortby=&b_where=&b_what=&page=",i)})
bands_and_styles0 <- read_html(pages_href[1]) %>% html_nodes("div.container") %>% html_nodes("div.cbox") %>% html_nodes("table") %>% html_nodes("tr") %>% html_nodes("td") %>% html_nodes("a") %>% html_text() %>% trimws(.)
stops <- which(bands_and_styles0 == "")
stops2 <- append(stops[2:length(stops)],length(bands_and_styles0)+1)
bands <- bands_and_styles0[stops+1]
styles <- sapply(1:length(stops), function(i){
paste(bands_and_styles0[(stops[i]+2):(stops2[i]-1)],collapse = ",")
})
origins <- read_html(pages_href[1]) %>% html_nodes("div.container") %>% html_nodes("div.cbox") %>% html_nodes("table") %>% html_nodes("tr") %>% html_nodes("td:nth-child(5)") %>% html_text() %>% gsub("\n","",.) %>% gsub("\t","",.)
formed <- read_html(pages_href[1]) %>% html_nodes("div.container") %>% html_nodes("div.cbox") %>% html_nodes("table") %>% html_nodes("tr") %>% html_nodes("td:nth-child(6)") %>% html_text() %>% as.numeric(.)
split <- read_html(pages_href[1]) %>% html_nodes("div.container") %>% html_nodes("div.cbox") %>% html_nodes("table") %>% html_nodes("tr") %>% html_nodes("td:nth-child(7)") %>% html_text() %>% as.numeric(.)
fans <- read_html(pages_href[1]) %>% html_nodes("div.container") %>% html_nodes("div.cbox") %>% html_nodes("table") %>% html_nodes("tr") %>% html_nodes("td:nth-child(8)") %>% html_text() %>% as.numeric(.)
#data.frame(band_name= bands, style = styles,origin = origins,
#           formed = formed,split = split,fans = fans)
pages <- read_html(msbands) %>% html_nodes("div.container") %>% html_nodes("div.pull-right") %>% html_nodes("ul.pagination") %>% html_nodes("li") %>% html_nodes("a") %>% html_text() %>% tail(.,1) %>% as.numeric(.)
pages_href <- sapply(1:pages, function(i){
paste0("https://metalstorm.net/bands/index.php?b_sortby=&b_where=&b_what=&page=",i)})
scraped <- list(rep(NA,pages))
t1 <- Sys.time()
pg_read <- lapply(1:pages, function(page){
pg_read <- read_html(pages_href[page])
})
Sys.time() - t1
scraped <- mclapply(1:pages, function(page){
bands_and_styles0 <- pg_read[[page]]  %>% html_nodes("div.container") %>% html_nodes("div.cbox") %>% html_nodes("table") %>% html_nodes("tr") %>% html_nodes("td") %>% html_nodes("a") %>% html_text() %>% trimws(.)
stops <- which(bands_and_styles0 == "")
stops2 <- append(stops[2:length(stops)],length(bands_and_styles0)+1)
bands <- bands_and_styles0[stops+1]
styles <- sapply(1:length(stops), function(i){
paste(bands_and_styles0[(stops[i]+2):(stops2[i]-1)],collapse = ",")
})
origins <- pg_read[[page]] %>% html_nodes("div.container") %>% html_nodes("div.cbox") %>% html_nodes("table") %>% html_nodes("tr") %>% html_nodes("td:nth-child(5)") %>% html_text() %>% gsub("\n","",.) %>% gsub("\t","",.)
suppressWarnings({
formed <- pg_read[[page]]  %>% html_nodes("div.container") %>% html_nodes("div.cbox") %>% html_nodes("table") %>% html_nodes("tr") %>% html_nodes("td:nth-child(6)") %>% html_text() %>% as.numeric(.)
split <- pg_read[[page]]  %>% html_nodes("div.container") %>% html_nodes("div.cbox") %>% html_nodes("table") %>% html_nodes("tr") %>% html_nodes("td:nth-child(7)") %>% html_text() %>% as.numeric(.)
})
fans <- pg_read[[page]] %>% html_nodes("div.container") %>% html_nodes("div.cbox") %>% html_nodes("table") %>% html_nodes("tr") %>% html_nodes("td:nth-child(8)") %>% html_text() %>% as.numeric(.)
data.frame(band_name= bands, style = styles,origin = origins,
formed = formed,split = split,fans = fans)
},mc.cores = detectCores()-2)
scraped_data <- rbindlist(scraped)
?rbindlist
library(data.table)
scraped_data <- rbindlist(scraped)
View(scraped_data)
scraped_data <- rbindlist(scraped)
saveRDS(scraped_data,"metal_bands")
saveRDS(scraped_data,"metal_bands_scraped")
head(dt)
imported <- readRDS("metal_bands")
imported <- readRDS("metal_bands_scraped")
dt <- as.data.table(imported)
head(dt)
?map_data
library(shiny)
runApp("Metal_World_win")
library(shiny)
runApp("Metal_World")
![Fancy image description]("Desktop/example1")
![Example1]("Desktop/example1")
![Example1]("Desktop/example1.png")
![Example1](Desktop/example1.png)
[Example1](Desktop/example1.png)
library(shiny)
runApp("Metal_World")
nrow(dt)
runApp("Metal_World")
library(shiny)
runApp("Metal_World")
